<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertex OS | Enterprise</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: { 
                        'glass': 'rgba(20, 20, 20, 0.7)',
                        'accent': '#3b82f6',
                        'system-red': '#ff453a',
                        'system-yellow': '#ffd60a',
                        'system-green': '#32d74b'
                    },
                    boxShadow: {
                        'glass': '0 25px 50px -12px rgba(0, 0, 0, 0.5)',
                        'glow': '0 0 40px rgba(59, 130, 246, 0.4)'
                    },
                    animation: {
                        'boot-pulse': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    }
                }
            }
        }
    </script>
    <style>
        body { background: #000; color: #fff; height: 100vh; overflow: hidden; user-select: none; cursor: default; }

        /* WALLPAPER & OVERLAYS */
        #desktop {
            position: absolute; inset: 0;
            background: url('https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?q=80&w=2574&auto=format&fit=crop') no-repeat center center;
            background-size: cover; z-index: 0;
            transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1), filter 0.6s;
        }
        #desktop.blurred { transform: scale(1.05); filter: blur(18px) brightness(0.8); }

        /* MICA MATERIAL (Glass Engine) */
        .mica {
            background: rgba(18, 18, 18, 0.75);
            backdrop-filter: blur(40px) saturate(140%);
            -webkit-backdrop-filter: blur(40px) saturate(140%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
        }

        /* WINDOW MANAGER */
        .window {
            position: absolute; display: flex; flex-direction: column;
            border-radius: 12px; overflow: hidden;
            min-width: 320px; min-height: 200px;
            opacity: 0; transform: scale(0.92) translateY(15px);
            transition: opacity 0.25s, transform 0.3s cubic-bezier(0.19, 1, 0.22, 1);
            box-shadow: 0 0 0 1px rgba(0,0,0,0.4), 0 40px 80px rgba(0,0,0,0.7);
        }
        .window.open { opacity: 1; transform: scale(1) translateY(0); }
        .window.active { border: 1px solid rgba(255,255,255,0.15); box-shadow: 0 0 0 1px rgba(255,255,255,0.1), 0 50px 100px rgba(0,0,0,0.8); }

        .win-header {
            height: 42px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px; background: rgba(255,255,255,0.03); border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .win-content { flex: 1; background: #0a0a0a; position: relative; }
        .win-content iframe { width: 100%; height: 100%; border: none; background: #0a0a0a; }
        .drag-shield { position: absolute; inset: 0; display: none; z-index: 50; }
        .window.dragging .drag-shield { display: block; }

        .win-controls { display: flex; gap: 8px; }
        .win-btn { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; position: relative; transition: 0.2s; }
        .btn-close { background: #ff453a; } .btn-min { background: #ff9f0a; } .btn-max { background: #30d158; }
        .win-controls:hover .btn-close::after { content: '×'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 10px; color: rgba(0,0,0,0.5); font-weight: 800; }
        .win-controls:hover .btn-min::after { content: '-'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 10px; color: rgba(0,0,0,0.5); font-weight: 800; }
        .win-controls:hover .btn-max::after { content: '+'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 10px; color: rgba(0,0,0,0.5); font-weight: 800; }

        /* START MENU */
        #start-menu {
            position: fixed; bottom: -120%; left: 50%; transform: translateX(-50%);
            width: 580px; height: 650px; border-radius: 18px;
            display: flex; flex-direction: column; padding: 24px;
            transition: bottom 0.5s cubic-bezier(0.19, 1, 0.22, 1); z-index: 90;
        }
        #start-menu.active { bottom: 90px; }

        .app-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 20px; margin-top: 24px; }
        .app-item {
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            cursor: pointer; padding: 10px; border-radius: 12px; transition: 0.2s;
        }
        .app-item:hover { background: rgba(255,255,255,0.08); transform: translateY(-2px); }
        .app-icon-lg { 
            width: 54px; height: 54px; border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-size: 24px; color: white;
            transition: 0.2s;
        }
        .app-item:hover .app-icon-lg { box-shadow: 0 8px 25px rgba(0,0,0,0.4); }

        /* TASKBAR */
        .taskbar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 8px; padding: 8px 12px; border-radius: 16px;
            z-index: 100; transition: 0.3s;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .task-icon {
            width: 44px; height: 44px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; position: relative; transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            background: rgba(255,255,255,0.03);
        }
        .task-icon:hover { background: rgba(255,255,255,0.15); transform: translateY(-5px); }
        .task-icon:active { transform: scale(0.9); }
        .task-icon.active::after {
            content: ''; position: absolute; bottom: 3px; width: 4px; height: 4px;
            background: #60a5fa; border-radius: 50%; box-shadow: 0 0 10px #60a5fa; transition: 0.3s;
        }
        .task-icon.active:hover::after { width: 16px; border-radius: 2px; height: 3px; }

        /* TOAST ENGINE */
        #toast-area { position: fixed; bottom: 100px; right: 24px; display: flex; flex-direction: column; gap: 12px; z-index: 9999; }
        .toast {
            background: rgba(20, 20, 20, 0.85); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1); border-left: 4px solid #3b82f6;
            padding: 14px 18px; border-radius: 10px; min-width: 280px;
            color: #fff; font-size: 13px; font-weight: 500;
            transform: translateX(100%); opacity: 0; transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            display: flex; align-items: center; gap: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .toast.show { transform: translateX(0); opacity: 1; }
        
        /* CONTEXT MENU */
        #context-menu {
            position: absolute; width: 220px; display: none; flex-direction: column;
            border-radius: 12px; padding: 6px; z-index: 9999;
        }
        .ctx-item {
            padding: 8px 12px; font-size: 13px; border-radius: 6px; cursor: pointer;
            display: flex; align-items: center; gap: 10px; transition: 0.1s; color: #e4e4e7;
        }
        .ctx-item:hover { background: #3b82f6; color: white; }
    </style>
</head>
<body>

    <div id="boot" class="fixed inset-0 bg-black z-[999] flex flex-col items-center justify-center transition-opacity duration-1000">
        <div id="boot-logo" class="w-24 h-24 bg-zinc-900 rounded-3xl mb-8 flex items-center justify-center shadow-glow animate-boot-pulse"></div>
        <div class="w-48 h-1 bg-zinc-900 rounded-full overflow-hidden">
            <div id="boot-bar" class="h-full bg-white w-0 transition-all duration-[1500ms] ease-out"></div>
        </div>
        <div class="mt-4 text-xs font-mono text-zinc-500">INITIALIZING VERTEX KERNEL...</div>
    </div>

    <div id="toast-area"></div>

    <div id="context-menu" class="mica">
        <div class="ctx-item" onclick="refreshDesktop()"><i data-lucide="refresh-cw" class="w-4 h-4"></i> Refresh System</div>
        <div class="h-px bg-white/10 my-1 mx-2"></div>
        <div class="ctx-item" onclick="toggleSettings()"><i data-lucide="settings" class="w-4 h-4"></i> System Preferences</div>
        <div class="ctx-item" onclick="openFullscreen()"><i data-lucide="monitor" class="w-4 h-4"></i> Enter Fullscreen</div>
        <div class="h-px bg-white/10 my-1 mx-2"></div>
        <div class="ctx-item" onclick="showToast('Version 5.2 Enterprise')"><i data-lucide="info" class="w-4 h-4"></i> About Vertex OS</div>
    </div>

    <div id="desktop" onclick="handleDesktopClick(event)"></div>

    <div class="fixed top-0 w-full h-9 flex justify-between items-center px-5 z-50 pointer-events-none select-none">
        <div class="flex items-center gap-2 pointer-events-auto cursor-pointer hover:opacity-80 transition" onclick="showToast('Vertex Creative Inc.')">
            <span class="text-[11px] font-bold tracking-widest uppercase opacity-80">Vertex</span>
            <span class="text-[9px] bg-white/10 px-1.5 py-0.5 rounded text-zinc-400">ENT</span>
        </div>
        <div class="pointer-events-auto cursor-pointer flex items-center gap-4 bg-black/30 backdrop-blur-md px-4 py-1 rounded-full border border-white/5 hover:bg-black/50 transition active:scale-95 shadow-lg" onclick="toggleSettings(event)">
            <i data-lucide="wifi" class="w-3 h-3"></i>
            <i data-lucide="battery" class="w-3 h-3"></i>
            <div id="clock" class="text-[11px] font-medium ml-1 font-mono">12:00</div>
        </div>
    </div>

    <div id="windows" class="absolute inset-0 overflow-hidden pointer-events-none"></div>

    <div id="start-menu" class="mica">
        <div class="relative mb-6">
            <i data-lucide="search" class="absolute left-4 top-3 w-4 h-4 text-gray-500"></i>
            <input type="text" id="app-search" placeholder="Search applications, files, and settings..." onkeyup="filterApps()" 
                   class="w-full bg-black/20 border border-white/10 rounded-xl pl-11 pr-4 py-2.5 text-sm outline-none focus:border-blue-500 focus:bg-black/40 transition text-white placeholder-gray-600">
        </div>
        
        <div class="flex justify-between items-end mb-2 px-1">
            <div class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">Pinned</div>
            <button class="text-[10px] text-blue-400 hover:text-blue-300 transition">All Apps ></button>
        </div>
        
        <div class="app-grid" id="app-grid-container">
            <div class="app-item" data-name="passforge" onclick="launch('passforge', 'PassForge', 'app/passforge.html', 400, 600)">
                <div class="app-icon-lg bg-blue-600"><i data-lucide="shield-check"></i></div>
                <span class="text-[11px] font-medium text-gray-300">PassForge</span>
            </div>
            
            <div class="app-item" data-name="qrx" onclick="launch('qrx', 'QR-X', 'app/qrx.html', 500, 700)">
                <div class="app-icon-lg bg-rose-600"><i data-lucide="qr-code"></i></div>
                <span class="text-[11px] font-medium text-gray-300">QR-X</span>
            </div>

            <div class="app-item" data-name="lumix" onclick="launch('lumix', 'Lumix Pro', 'app/lumixpro.html', 900, 650)">
                <div class="app-icon-lg bg-purple-600"><i data-lucide="palette"></i></div>
                <span class="text-[11px] font-medium text-gray-300">Lumix</span>
            </div>

            <div class="app-item" data-name="typex" onclick="launch('typex', 'Type-X', 'app/typex.html', 800, 500)">
                <div class="app-icon-lg bg-green-600"><i data-lucide="keyboard"></i></div>
                <span class="text-[11px] font-medium text-gray-300">Type-X</span>
            </div>

            <div class="app-item" data-name="reflex" onclick="launch('reflex', 'RefleX', 'app/reflex.html', 800, 600)">
                <div class="app-icon-lg bg-yellow-500"><i data-lucide="crosshair"></i></div>
                <span class="text-[11px] font-medium text-gray-300">RefleX</span>
            </div>

            <div class="app-item" data-name="gravitas" onclick="launch('gravitas', 'Gravitas', 'app/gravitas.html', 1000, 700)">
                <div class="app-icon-lg bg-cyan-600"><i data-lucide="orbit"></i></div>
                <span class="text-[11px] font-medium text-gray-300">Gravitas</span>
            </div>

            <div class="app-item" data-name="kinetix" onclick="launch('kinetix', 'Kinetix', 'app/kinetix.html', 1000, 700)">
                <div class="app-icon-lg bg-indigo-600"><i data-lucide="film"></i></div>
                <span class="text-[11px] font-medium text-gray-300">Kinetix</span>
            </div>

            <div class="app-item" data-name="seqx" onclick="launch('seqx', 'SeQ-X', 'app/seqx.html', 500, 600)">
                <div class="app-icon-lg bg-pink-600"><i data-lucide="brain-circuit"></i></div>
                <span class="text-[11px] font-medium text-gray-300">SeQ-X</span>
            </div>
        </div>

        <div class="mt-auto pt-5 border-t border-white/10 flex items-center justify-between px-2">
            <div class="flex items-center gap-3 hover:bg-white/5 p-2 rounded-xl cursor-pointer transition w-full">
                <div id="user-avatar" class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center"></div>
                <div>
                    <div id="user-name" class="text-xs font-semibold text-white">Guest User</div>
                    <div class="text-[10px] text-gray-500">Vertex Account</div>
                </div>
            </div>
            <div class="p-2.5 hover:bg-white/10 rounded-lg cursor-pointer transition text-red-400" onclick="location.reload()" title="System Restart">
                <i data-lucide="power" class="w-5 h-5"></i>
            </div>
        </div>
    </div>

    <div id="qs-panel" class="mica fixed bottom-20 right-5 w-80 rounded-2xl p-5 translate-y-[150%] transition-transform duration-300 z-[110]">
        <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-white/5 border border-white/5 hover:bg-white/10 p-3 rounded-xl cursor-pointer transition flex flex-col gap-2 active:scale-95 h-20 justify-between group" onclick="toggleQS('wifi', 'Wi-Fi')">
                <i data-lucide="wifi" class="w-5 h-5 text-gray-400 group-hover:text-white transition" id="icon-wifi"></i>
                <div>
                    <div class="text-xs font-bold">Wi-Fi</div>
                    <div class="text-[10px] text-gray-500" id="status-wifi">Off</div>
                </div>
            </div>
            <div class="bg-white/5 border border-white/5 hover:bg-white/10 p-3 rounded-xl cursor-pointer transition flex flex-col gap-2 active:scale-95 h-20 justify-between group" onclick="toggleQS('bt', 'Bluetooth')">
                <i data-lucide="bluetooth" class="w-5 h-5 text-gray-400 group-hover:text-white transition" id="icon-bt"></i>
                <div>
                    <div class="text-xs font-bold">Bluetooth</div>
                    <div class="text-[10px] text-gray-500" id="status-bt">Off</div>
                </div>
            </div>
        </div>
        <div class="space-y-4">
            <div class="bg-black/30 p-3 rounded-xl flex items-center gap-3">
                <i data-lucide="sun" class="w-4 h-4 text-gray-400"></i>
                <input type="range" class="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
            </div>
            <div class="bg-black/30 p-3 rounded-xl flex items-center gap-3">
                <i data-lucide="volume-2" class="w-4 h-4 text-gray-400"></i>
                <input type="range" class="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
            </div>
        </div>
    </div>

    <div class="taskbar mica">
        <div class="task-icon hover:bg-white/10" onclick="toggleStart()" title="Start">
            <svg viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-blue-500 filter drop-shadow-[0_0_8px_rgba(59,130,246,0.5)]"><path d="M4 4h7v7H4zm0 9h7v7H4zm9-9h7v7h-7zm0 9h7v7h-7z"/></svg>
        </div>
        <div class="w-px h-6 bg-white/10 my-auto mx-2"></div>
        <div id="task-apps" class="flex gap-1"></div>
    </div>

    <script>
        // --- ⚙️ ENTERPRISE CONFIGURATION ---
        const CONFIG = {
            logo: "https://cdn.discordapp.com/icons/1467910208796758231/fcfe701db117f2cef9e9b8350a1fc8d8.webp?size=1024",
            currentUser: "Guest User"
        };

        // --- SYSTEM INIT ---
        window.onload = () => {
            lucide.createIcons();
            initBranding();
            startClock();
            
            // Boot Animation
            setTimeout(() => document.getElementById('boot-bar').style.width = '100%', 100);
            setTimeout(() => {
                const boot = document.getElementById('boot');
                boot.style.opacity = '0';
                setTimeout(() => {
                    boot.remove();
                    showToast('System Online: Visitor Access', 'shield-check');
                }, 1000);
            }, 1800);

            // Context Menu Logic
            document.addEventListener('contextmenu', e => {
                e.preventDefault();
                const menu = document.getElementById('context-menu');
                menu.style.display = 'flex';
                menu.style.left = `${e.pageX}px`;
                menu.style.top = `${e.pageY}px`;
            });
        };

        function initBranding() {
            // Boot Logo (Auto-Squircle)
            const bootLogo = document.getElementById('boot-logo');
            if(CONFIG.logo) {
                bootLogo.innerHTML = `<img src="${CONFIG.logo}" class="w-full h-full object-cover rounded-3xl">`;
                bootLogo.classList.remove('bg-zinc-900');
            }

            // Profile Avatar (Auto-Circle)
            const userAvatar = document.getElementById('user-avatar');
            if(CONFIG.logo) {
                userAvatar.innerHTML = `<img src="${CONFIG.logo}" class="w-full h-full object-cover rounded-full">`;
                userAvatar.classList.remove('bg-zinc-800');
            }

            // Username
            document.getElementById('user-name').innerText = CONFIG.currentUser;
        }

        // --- CORE UI ---
        function startClock() {
            const update = () => document.getElementById('clock').innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            setInterval(update, 1000);
            update();
        }

        function handleDesktopClick() {
            closeAllMenus();
        }

        function closeAllMenus() {
            document.getElementById('start-menu').classList.remove('active');
            document.getElementById('qs-panel').classList.remove('active');
            document.getElementById('desktop').classList.remove('blurred');
            document.getElementById('context-menu').style.display = 'none';
        }

        function toggleStart() {
            const menu = document.getElementById('start-menu');
            const desk = document.getElementById('desktop');
            const isActive = menu.classList.contains('active');
            closeAllMenus();
            if (!isActive) {
                menu.classList.add('active');
                desk.classList.add('blurred');
                setTimeout(() => document.getElementById('app-search').focus(), 100);
            }
        }

        function toggleSettings(e) {
            if(e) e.stopPropagation();
            const set = document.getElementById('qs-panel');
            const isActive = set.classList.contains('active');
            closeAllMenus();
            if (!isActive) set.classList.add('active');
        }

        function toggleQS(type, name) {
            const icon = document.getElementById(`icon-${type}`);
            const status = document.getElementById(`status-${type}`);
            const isActive = icon.classList.contains('text-blue-400'); // Check current state

            if (isActive) {
                // Turn Off
                icon.classList.replace('text-blue-400', 'text-gray-400');
                status.innerText = "Off";
                status.classList.remove('text-blue-400');
                showToast(`${name} Disabled`, 'slash');
            } else {
                // Turn On
                icon.classList.replace('text-gray-400', 'text-blue-400');
                status.innerText = "Active";
                status.classList.add('text-blue-400');
                showToast(`${name} Enabled`, 'check');
            }
        }

        function showToast(msg, iconName = 'info') {
            const area = document.getElementById('toast-area');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<i data-lucide="${iconName}" class="w-4 h-4 text-blue-400"></i> ${msg}`;
            area.appendChild(toast);
            lucide.createIcons();
            
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        function filterApps() {
            const query = document.getElementById('app-search').value.toLowerCase();
            const apps = document.querySelectorAll('.app-item');
            apps.forEach(app => {
                const name = app.dataset.name;
                app.style.display = name.includes(query) ? 'flex' : 'none';
            });
        }

        function refreshDesktop() {
            handleDesktopClick();
            const desk = document.getElementById('desktop');
            desk.style.transform = "scale(0.98)";
            desk.style.opacity = "0.8";
            setTimeout(() => {
                desk.style.transform = "scale(1)";
                desk.style.opacity = "1";
                showToast('System Refreshed', 'refresh-cw');
            }, 300);
        }

        function openFullscreen() {
            handleDesktopClick();
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else if (document.exitFullscreen) document.exitFullscreen();
        }

        // --- WINDOW KERNEL ---
        let zIndex = 100;
        let activeApps = {};

        function launch(key, title, url, w, h) {
            closeAllMenus();
            
            if (activeApps[key]) {
                const win = activeApps[key].window;
                // FIX: Check for CSS class 'open' instead of inline opacity
                const isOpen = win.classList.contains('open');

                if (!isOpen) {
                    restoreWindow(key);
                } else {
                    if(win.classList.contains('active')) minimizeWindow(key);
                    else focusWindow(win);
                }
                return;
            }

            createWindow(key, title, url, w, h);
            addToTaskbar(key);
        }

        function createWindow(key, title, url, w, h) {
            zIndex++;
            const win = document.createElement('div');
            win.className = 'window mica pointer-events-auto';
            win.id = `win-${key}`;
            
            const x = Math.max(0, (window.innerWidth/2) - (w/2) + (Math.random()*40-20));
            const y = Math.max(40, (window.innerHeight/2) - (h/2) + (Math.random()*40-20));

            win.style.width = `${w}px`;
            win.style.height = `${h}px`;
            win.style.left = `${x}px`;
            win.style.top = `${y}px`;
            win.style.zIndex = zIndex;

            win.innerHTML = `
                <div class="win-header" onmousedown="startDrag(event, '${key}')">
                    <div class="flex items-center gap-2 pointer-events-none">
                        <span class="text-xs font-semibold text-gray-200">${title}</span>
                    </div>
                    <div class="win-controls" onmousedown="event.stopPropagation()">
                        <div class="win-btn btn-min" onclick="minimizeWindow('${key}')"></div>
                        <div class="win-btn btn-max" onclick="maximizeWindow('${key}')"></div>
                        <div class="win-btn btn-close" onclick="closeWindow('${key}')"></div>
                    </div>
                </div>
                <div class="win-content">
                    <div class="drag-shield"></div>
                    <iframe src="${url}"></iframe>
                </div>
            `;

            win.addEventListener('mousedown', () => focusWindow(win));
            document.getElementById('windows').appendChild(win);
            requestAnimationFrame(() => win.classList.add('open'));
            
            activeApps[key] = { window: win };
            focusWindow(win);
        }

        function addToTaskbar(key) {
            const bar = document.getElementById('task-apps');
            const icon = document.createElement('div');
            icon.className = 'task-icon active';
            icon.id = `task-${key}`;
            icon.onclick = () => launch(key);
            
            // Clone Icon from App Grid
            const srcIcon = document.querySelector(`.app-item[data-name="${key}"] .app-icon-lg`).cloneNode(true);
            srcIcon.className = "w-6 h-6 rounded-md flex items-center justify-center text-[10px]";
            // Remove large shadows/sizes
            srcIcon.style.width = "100%";
            srcIcon.style.height = "100%";
            srcIcon.style.fontSize = "14px";
            srcIcon.style.boxShadow = "none";
            
            icon.appendChild(srcIcon);
            bar.appendChild(icon);
        }

        function focusWindow(win) {
            zIndex++;
            win.style.zIndex = zIndex;
            document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
            win.classList.add('active');
        }

        function closeWindow(key) {
            const win = activeApps[key].window;
            win.classList.remove('open');
            setTimeout(() => {
                win.remove();
                document.getElementById(`task-${key}`).remove();
                delete activeApps[key];
            }, 250);
        }

        function minimizeWindow(key) {
            const win = activeApps[key].window;
            win.classList.remove('open');
            win.style.pointerEvents = 'none';
            document.getElementById(`task-${key}`).classList.remove('active');
        }

        function restoreWindow(key) {
            const win = activeApps[key].window;
            win.classList.add('open');
            win.style.pointerEvents = 'auto';
            document.getElementById(`task-${key}`).classList.add('active');
            focusWindow(win);
        }

        function maximizeWindow(key) {
            const win = activeApps[key].window;
            focusWindow(win);
            if(win.dataset.max === 'true') {
                win.style.width = win.dataset.w;
                win.style.height = win.dataset.h;
                win.style.left = win.dataset.x;
                win.style.top = win.dataset.y;
                win.style.borderRadius = "12px";
                win.dataset.max = 'false';
            } else {
                win.dataset.w = win.style.width;
                win.dataset.h = win.style.height;
                win.dataset.x = win.style.left;
                win.dataset.y = win.style.top;
                
                win.style.width = '100%';
                win.style.height = 'calc(100% - 66px)'; // Minus taskbar area
                win.style.left = '0';
                win.style.top = '0';
                win.style.borderRadius = "0";
                win.dataset.max = 'true';
            }
        }

        // --- DRAG PHYSICS ---
        let isDragging = false, dragWin = null, offset = {x:0, y:0};

        function startDrag(e, key) {
            const win = activeApps[key].window;
            if(win.dataset.max === 'true') return;
            isDragging = true;
            dragWin = win;
            focusWindow(win);
            win.classList.add('dragging');
            const rect = win.getBoundingClientRect();
            offset.x = e.clientX - rect.left;
            offset.y = e.clientY - rect.top;
            document.addEventListener('mousemove', onDrag);
            document.addEventListener('mouseup', stopDrag);
        }

        function onDrag(e) {
            if(!isDragging) return;
            let x = e.clientX - offset.x;
            let y = e.clientY - offset.y;
            if(y < 0) y = 0; // Top constraint
            dragWin.style.left = `${x}px`;
            dragWin.style.top = `${y}px`;
        }

        function stopDrag() {
            isDragging = false;
            if(dragWin) dragWin.classList.remove('dragging');
            dragWin = null;
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('mouseup', stopDrag);
        }
    </script>
</body>
</html>
